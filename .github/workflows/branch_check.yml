name: ğŸ›¡ï¸ Branch Merge Check

on:
  # Pull Requestê°€ ì—´ë¦¬ê±°ë‚˜ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
  pull_request:
    types: [opened, synchronize, reopened]
    # main ë¸Œëœì¹˜ë¡œ ë“¤ì–´ì˜¤ëŠ” PRì— ëŒ€í•´ì„œë§Œ ì‹¤í–‰í•˜ë„ë¡ ì œí•œí•©ë‹ˆë‹¤.
    branches:
      - main 

jobs:
  check_allowed_source_branch:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“ Set Allowed Source Branch
        # mainìœ¼ë¡œ ë³‘í•©ì´ í—ˆìš©ë˜ëŠ” ìœ ì¼í•œ ë¸Œëœì¹˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
        run: echo "ALLOWED_BRANCH=dev" >> $GITHUB_ENV

      - name: ğŸ” Check Branch Compliance
        # GITHUB_BASE_REFëŠ” PRì˜ ëŒ€ìƒ ë¸Œëœì¹˜ (main)
        # GITHUB_HEAD_REFëŠ” PRì˜ ì†ŒìŠ¤ ë¸Œëœì¹˜ (feature/A ë“±)
        run: |
          echo "PR Base Branch: ${{ github.base_ref }}"
          echo "PR Head Branch: ${{ github.head_ref }}"
          echo "Allowed Source Branch: ${{ env.ALLOWED_BRANCH }}"

          # ëŒ€ìƒì´ 'main'ì´ê³ , ì†ŒìŠ¤ê°€ 'dev'ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì‹¤íŒ¨ ì²˜ë¦¬
          if [[ "${{ github.base_ref }}" == "main" && "${{ github.head_ref }}" != "${{ env.ALLOWED_BRANCH }}" ]]; then
            echo "::error title=Forbidden Merge::Merging from branch '${{ github.head_ref }}' into 'main' is strictly prohibited. Please merge into '${{ env.ALLOWED_BRANCH }}' first."
            exit 1 # ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨ ì²˜ë¦¬
          else
            echo "Branch check passed. Allowed to merge from ${{ github.head_ref }} to ${{ github.base_ref }}."
          fi
